<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard - Teacher Feedback System</title>
    <!-- Client-side error capture (records errors to localStorage.tfs_client_errors) -->
    <script>
    (function(){
        function recordError(obj){
            try{
                const key = 'tfs_client_errors';
                const prev = JSON.parse(localStorage.getItem(key) || '[]');
                prev.push(Object.assign({time: new Date().toISOString()}, obj));
                localStorage.setItem(key, JSON.stringify(prev));
                console.error('TFS captured error:', obj);
            }catch(e){}
        }
        window.addEventListener('error', function(e){
            recordError({type:'error', message: e.message, filename: e.filename, lineno: e.lineno, colno: e.colno, stack: (e.error && e.error.stack) || null});
        });
        window.addEventListener('unhandledrejection', function(e){
            const reason = e.reason || {};
            recordError({type:'unhandledrejection', message: reason.message || String(reason), stack: reason.stack || null});
        });
        window.getCapturedClientErrors = function(){ return JSON.parse(localStorage.getItem('tfs_client_errors') || '[]'); };
    })();
    </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600,700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <style>
    body { font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }
    .sidebar { min-width: 220px; }
    .kpi { min-width: 160px; }
    .table-scroll::-webkit-scrollbar { height: 8px; }
    .table-scroll::-webkit-scrollbar-thumb { background: rgba(99,102,241,0.4); border-radius: 9999px; }
  </style>
</head>
        <div class="flex-1 p-8">
            <!-- Overview Section -->
            <div id="overview-section" class="section-content">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">Dashboard Overview</h1>
                    <p class="text-gray-600">Real-time insights into teacher feedback and system performance</p>
                </div>

                <!-- Key Metrics -->
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="metric-card bg-white rounded-xl p-6 shadow-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-primary rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                            </div>
                            <span class="text-sm font-medium text-green-600 bg-green-100 px-2 py-1 rounded-full">+12%</span>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-1">1,247</h3>
                        <p class="text-gray-600 text-sm">Total Students</p>
                    </div>

                    <div class="metric-card bg-white rounded-xl p-6 shadow-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-secondary rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                </svg>
                            </div>
                            <span class="text-sm font-medium text-green-600 bg-green-100 px-2 py-1 rounded-full">+8%</span>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-1">89</h3>
                        <p class="text-gray-600 text-sm">Active Teachers</p>
                    </div>

                    <div class="metric-card bg-white rounded-xl p-6 shadow-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-accent rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <span class="text-sm font-medium text-green-600 bg-green-100 px-2 py-1 rounded-full">+15%</span>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-1">3,421</h3>
                        <p class="text-gray-600 text-sm">Feedback Submitted</p>
                    </div>

                    <div class="metric-card bg-white rounded-xl p-6 shadow-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-success rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                                </svg>
                            </div>
                            <span class="text-sm font-medium text-green-600 bg-green-100 px-2 py-1 rounded-full">+5%</span>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-1">4.2</h3>
                        <p class="text-gray-600 text-sm">Average Rating</p>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="grid lg:grid-cols-2 gap-8 mb-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Feedback Trends</h3>
                        <div id="feedback-trends-chart" class="chart-container"></div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Teacher Performance</h3>
                        <div id="teacher-performance-chart" class="chart-container"></div>
                    </div>
                </div>

                <!-- Power BI Section -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-gray-900">Power BI Analytics Dashboard</h3>
                        <div class="flex items-center space-x-2">
                            <button id="refresh-dashboard" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-800 transition-colors">
                                Refresh Data
                            </button>
                            <button id="export-dashboard" class="border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors">
                                Export Report
                            </button>
                        </div>
                    </div>
                    <div class="powerbi-container">
                        <div class="text-center mb-3">
                            <div class="w-16 h-16 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                            </div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-2">Power BI Dashboard</h4>
                            <p class="text-gray-600 mb-4">Interactive analytics and reporting dashboard</p>
                        </div>
                                                <div class="w-full px-4">
                                                    <!-- Embed iframe (hidden until an embed URL is loaded) -->
                                                    <div class="mb-4">
                                                        <iframe id="powerbi-embed" src="about:blank" class="w-full rounded-md" style="border:0; display:none; height:420px;" title="Power BI Embed"></iframe>
                                                    </div>

                                                    <div class="flex flex-col gap-3">
                                                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                                                                                        <div class="flex items-center space-x-3">
                                                                                                <a id="download-pbix" href="resources/feedback.pbix" download class="px-3 py-2 bg-primary text-white rounded-md text-sm hover:bg-blue-800">Download PBIX</a>
                                                                                                <div class="text-sm text-gray-600">(Downloaded file can be opened in Power BI Desktop)</div>
                                                                                            </div>
                                                                                            <div id="server-pbix-card" class="ml-4 px-3 py-2 border border-gray-200 rounded-md bg-white text-sm hidden">
                                                                                                <div class="font-medium">feedback.pbix</div>
                                                                                                <div id="server-pbix-size" class="text-xs text-gray-500">Checking size…</div>
                                                                                                <div class="mt-2 flex items-center gap-2">
                                                                                                    <a id="open-server-pbix" href="resources/feedback.pbix" target="_blank" class="px-2 py-1 border rounded text-sm">Open / Download</a>
                                                                                                    <a id="download-server-pbix" href="resources/feedback.pbix" download class="px-2 py-1 bg-primary text-white rounded text-sm">Download</a>
                                                                                                </div>
                                                                                            </div>

                                                            <div class="flex items-center space-x-2">
                                                                <label class="text-sm text-gray-700">Attach local PBIX</label>
                                                                <input id="upload-pbix" type="file" accept=".pbix" class="text-sm" />
                                                                <button id="open-local-pbix" class="px-3 py-2 border border-gray-300 rounded-md text-sm" disabled>Open</button>
                                                            </div>
                                                        </div>

                                                        <div class="flex items-center space-x-2">
                                                            <input id="embed-url-input" type="url" placeholder="Paste Power BI publish/embed URL here (https://...)" class="flex-1 px-3 py-2 border border-gray-300 rounded-md" />
                                                            <button id="load-embed-btn" class="px-3 py-2 bg-primary text-white rounded-md text-sm">Load Embed</button>
                                                            <button id="open-embed-new" class="px-3 py-2 border border-gray-300 rounded-md text-sm">Open in new tab</button>
                                                        </div>

                                                        <div id="pbix-info" class="mt-2 text-xs text-gray-500"></div>
                                                    </div>
                                                </div>
                    </div>
                </div>
            </div>

            <!-- User Management Section -->
            <div id="users-section" class="section-content hidden">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">User Management</h1>
                    <p class="text-gray-600">Manage student and teacher accounts</p>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-gray-900">Users</h3>
                        <button id="add-user" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-800 transition-colors">
                            Add User
                        </button>
                    </div>
                    
                    <div class="data-table">
                        <table class="w-full">
                            <thead class="bg-gray-50 sticky top-0">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body" class="bg-white divide-y divide-gray-200">
                                <!-- Users will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analytics-section" class="section-content hidden">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">Advanced Analytics</h1>
                    <p class="text-gray-600">Detailed insights and performance metrics</p>
                </div>

                <div class="grid lg:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Department Performance</h3>
                        <div id="department-chart" class="chart-container"></div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Feedback Distribution</h3>
                        <div id="distribution-chart" class="chart-container"></div>
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reports-section" class="section-content hidden">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">Reports</h1>
                    <p class="text-gray-600">Generate and download comprehensive reports</p>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="border border-gray-200 rounded-lg p-6 text-center">
                            <div class="w-12 h-12 bg-primary rounded-lg flex items-center justify-center mx-auto mb-4">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Teacher Performance Report</h3>
                            <p class="text-gray-600 text-sm mb-4">Comprehensive analysis of teacher feedback scores</p>
                            <button class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-800 transition-colors">
                                Generate Report
                            </button>
                        </div>

                        <div class="border border-gray-200 rounded-lg p-6 text-center">
                            <div class="w-12 h-12 bg-secondary rounded-lg flex items-center justify-center mx-auto mb-4">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Student Engagement Report</h3>
                            <p class="text-gray-600 text-sm mb-4">Analysis of student participation and feedback patterns</p>
                            <button class="bg-secondary text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                                Generate Report
                            </button>
                        </div>

                        <div class="border border-gray-200 rounded-lg p-6 text-center">
                            <div class="w-12 h-12 bg-accent rounded-lg flex items-center justify-center mx-auto mb-4">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">System Usage Report</h3>
                            <p class="text-gray-600 text-sm mb-4">Overall system performance and usage statistics</p>
                            <button class="bg-accent text-white px-4 py-2 rounded-lg hover:bg-amber-600 transition-colors">
                                Generate Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings-section" class="section-content hidden">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">System Settings</h1>
                    <p class="text-gray-600">Configure and manage system preferences</p>
                </div>

                <div class="grid lg:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-6">General Settings</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">System Name</label>
                                <input type="text" value="Teacher Feedback System" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Institution Name</label>
                                <input type="text" placeholder="Enter institution name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                                <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                                    <option>UTC</option>
                                    <option>EST</option>
                                    <option>PST</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-6">Security Settings</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-gray-700">Two-Factor Authentication</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-gray-700">Session Timeout (minutes)</span>
                                <select class="px-3 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                                    <option>30</option>
                                    <option>60</option>
                                    <option>120</option>
                                </select>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-gray-700">Password Complexity</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="main.js"></script>
        <script>
        // Wire up PBIX file input + open button (client-side only)
        document.addEventListener('DOMContentLoaded', function(){
            const upload = document.getElementById('upload-pbix');
            const openBtn = document.getElementById('open-local-pbix');
            const info = document.getElementById('pbix-info');
            let localPbixUrl = null;

            if(!upload || !openBtn || !info) return;

            upload.addEventListener('change', function(e){
                if(localPbixUrl){ URL.revokeObjectURL(localPbixUrl); localPbixUrl = null; }
                const f = e.target.files && e.target.files[0];
                if(f){
                    localPbixUrl = URL.createObjectURL(f);
                    info.textContent = `Selected: ${f.name} — ${(f.size/1024|0)} KB`;
                    openBtn.disabled = false;
                } else {
                    info.textContent = '';
                    openBtn.disabled = true;
                }
            });

            openBtn.addEventListener('click', function(){
                if(localPbixUrl){
                    // open a blob URL so browser will download / open with associated app
                    window.open(localPbixUrl);
                } else {
                    alert('Please choose a .pbix file first');
                }
            });
        });
                    // Show server-side PBIX card and fetch size
                    const serverCard = document.getElementById('server-pbix-card');
                    const serverSizeEl = document.getElementById('server-pbix-size');
                    if(serverCard && serverSizeEl){
                        const pbixUrl = 'resources/feedback.pbix';
                        fetch(pbixUrl, { method: 'HEAD' }).then(resp=>{
                            if(resp.ok){
                                const len = resp.headers.get('content-length');
                                if(len){
                                    const kb = Math.round(parseInt(len,10)/1024);
                                    serverSizeEl.textContent = `${kb} KB`;
                                } else {
                                    serverSizeEl.textContent = 'Size unknown';
                                }
                                serverCard.classList.remove('hidden');
                            }
                        }).catch(()=>{ serverSizeEl.textContent = 'Not available'; serverCard.classList.remove('hidden'); });
                    }

        </script>
                <script>
                // Embed URL loader for Power BI iframe
                document.addEventListener('DOMContentLoaded', function(){
                    const embedInput = document.getElementById('embed-url-input');
                    const loadBtn = document.getElementById('load-embed-btn');
                    const openNewBtn = document.getElementById('open-embed-new');
                    const iframe = document.getElementById('powerbi-embed');

                    if(!embedInput || !loadBtn || !iframe) return;

                    function isValidHttpUrl(string) {
                        try { new URL(string); return string.startsWith('http://') || string.startsWith('https://'); }
                        catch (_) { return false; }
                    }

                    loadBtn.addEventListener('click', function(){
                        const url = embedInput.value.trim();
                        if(!isValidHttpUrl(url)){
                            alert('Please enter a valid http(s) URL');
                            return;
                        }
                        // Set iframe src and show it
                        iframe.src = url;
                        iframe.style.display = 'block';
                        // update info area
                        const info = document.getElementById('pbix-info');
                        if(info) info.textContent = 'Loaded embed URL.';
                    });

                    openNewBtn && openNewBtn.addEventListener('click', function(){
                        const url = embedInput.value.trim();
                        if(!isValidHttpUrl(url)){ alert('Please enter a valid URL'); return; }
                        window.open(url, '_blank');
                    });
                });
                </script>
</body>
</html>